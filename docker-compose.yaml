services:
  signal-cli-rest-api:
    image: "bbernhard/signal-cli-rest-api:0.90"
    ports:
      - "8080:8080"
    volumes:
      - "$HOME/.local/share/signal-api:/home/.local/share/signal-cli"
    network_mode: "host"
    environment:
      - MODE=json-rpc
      - AUTO_RECEIVE_SCHEDULE_SEND_READ_RECEIPTS=true
    healthcheck:
      # Check that the signal-rest-api is working by the health end point
      test: ["CMD-SHELL", "curl -X GET -H \"Content-Type: application/json\" 'http://127.0.0.1:8080/v1/health'"]
      interval: 30s  # Check every 30 seconds
      retries: 5  # Try a maximum of 5 times
      timeout: 1s # If the curl commands takes more than 1 second to return, it is considered a failure
  signalblast:
    image: "eradorta/signalblast:$DOCKER_TAG"
    build:
      network: "host"
    network_mode: "host"
    volumes:
      - "$HOME/.local/share/signal-api/:/home/user/.local/share/signal-api/"
      - "./signalblast_data:/home/user/signalblast/signalblast/data"
    environment:
      - SIGNALBLAST_PHONE_NUMBER=$SIGNALBLAST_PHONE_NUMBER
      - SIGNALBLAST_PASSWORD=$SIGNALBLAST_PASSWORD
    depends_on:
      signal-cli-rest-api:
        condition: service_healthy
